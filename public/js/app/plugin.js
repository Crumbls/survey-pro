const n={events:{},wildcardEvents:{},on:function(a,i){if(a.includes("*")){var e="^"+a.replace(/\*/g,".*")+"$",t=new RegExp(e);this.wildcardEvents[a]||(this.wildcardEvents[a]={pattern:t,callbacks:[]}),this.wildcardEvents[a].callbacks.push(i);var r=this;return function(){r.wildcardEvents[a].callbacks=r.wildcardEvents[a].callbacks.filter(function(d){return d!==i})}}else{this.events[a]||(this.events[a]=[]),this.events[a].push(i);var r=this;return function(){r.events[a]=r.events[a].filter(function(p){return p!==i})}}},once:function(a,i){var e=this.on(a,function(t){e(),i(t)});return e},emit:function(a,i){var e=!1;if(this.events[a])for(var t=this.events[a],r=0;r<t.length;r++)t[r](i),e=!0;for(var d=Object.keys(this.wildcardEvents),p=0;p<d.length;p++){var y=d[p],b=this.wildcardEvents[y],S=b.pattern,F=b.callbacks;if(S.test(a))for(var k=0;k<F.length;k++)F[k](i,a),e=!0}return e},off:function(a){a.includes("*")?delete this.wildcardEvents[a]:delete this.events[a]},clear:function(){this.events={},this.wildcardEvents={}},channel:function(a){var i=a,e=this;return{on:function(t,r){return e.on(i+"."+t,r)},once:function(t,r){return e.once(i+"."+t,r)},emit:function(t,r){return e.emit(i+"."+t,r)},off:function(t){e.off(i+"."+t)},clear:function(){e.off(i+".*")}}}};function H(a){a.magic("bus",()=>({on:function(i,e){return n.on(i,e)},once:function(i,e){return n.once(i,e)},emit:function(i,e){return n.emit(i,e)},off:function(i){n.off(i)},clear:function(){n.clear()},chain:function(i,e){return n.on(i,function(t){n.emit(e,t)})},channel:function(i){return n.channel(i)}}))}window.eventBus=n;window.Alpine?H(window.Alpine):document.addEventListener("alpine:init",()=>{H(window.Alpine)});const fe={open:!1,tabsVisible:!0,agent:{enabled:!1},ticket:{enabled:!0},knowledgebase:{enabled:!0,query:""},polling:{enabled:!0,initialInterval:5,inactiveInterval:15,idleInterval:30,activityThreshold:60,idleThreshold:300},ui:{showTimestamps:!0,showAvatars:!0,messageAlignment:"right",theme:"light"},fileUpload:{enabled:!0,maxSize:5,allowedTypes:["image/*","application/pdf",".doc",".docx",".xls",".xlsx"],maxFiles:3}};function pe(a={}){return ae(fe,a)}function ae(a,i){const e=Object.assign({},a);return _(a)&&_(i)&&Object.keys(i).forEach(t=>{_(i[t])?t in a?e[t]=ae(a[t],i[t]):Object.assign(e,{[t]:i[t]}):Object.assign(e,{[t]:i[t]})}),e}function _(a){return a&&typeof a=="object"&&!Array.isArray(a)}function me(a){const i={...a};return!i.agent.enabled&&!i.ticket.enabled&&!i.knowledgebase.enabled&&(console.warn("At least one feature must be enabled. Enabling ticket feature by default."),i.ticket.enabled=!0),i.polling.initialInterval=Math.max(1,i.polling.initialInterval),i.polling.inactiveInterval=Math.max(i.polling.initialInterval,i.polling.inactiveInterval),i.polling.idleInterval=Math.max(i.polling.inactiveInterval,i.polling.idleInterval),i.fileUpload.enabled&&(i.fileUpload.maxSize=Math.max(1,i.fileUpload.maxSize),i.fileUpload.maxFiles=Math.max(1,i.fileUpload.maxFiles)),i}function he(a){return["agent","ticket","knowledgebase"].find(e=>a[e]&&a[e].enabled===!0)||null}function se(a={}){var E,x,A,l,c;const i={initialInterval:((E=a.polling)==null?void 0:E.initialInterval)||5,inactiveInterval:((x=a.polling)==null?void 0:x.inactiveInterval)||15,idleInterval:((A=a.polling)==null?void 0:A.idleInterval)||30,activityThreshold:((l=a.polling)==null?void 0:l.activityThreshold)||60,idleThreshold:((c=a.polling)==null?void 0:c.idleThreshold)||300};let e={lastActivityTime:Date.now(),currentInterval:i.initialInterval,checkIntervalId:null,isPollingActive:!0,livewireComponent:null,activityListeners:[]};function t(m,L=null){e.livewireComponent=L,r(m),p(),n.on("chat:opened",()=>{d(),b(!0)}),n.on("chat:closed",()=>{b(!1)})}function r(m){if(!m)return;["click","keydown","mousedown","touchstart","scroll"].forEach(M=>{const P=d;m.addEventListener(M,P),e.activityListeners.push({element:m,type:M,handler:P})})}function d(){e.lastActivityTime=Date.now(),e.currentInterval!==i.initialInterval&&(e.currentInterval=i.initialInterval,n.emit("activity:intervalChanged",{interval:e.currentInterval})),e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("recordActivity"),n.emit("activity:detected",{timestamp:e.lastActivityTime})}function p(){e.checkIntervalId&&clearInterval(e.checkIntervalId),e.checkIntervalId=setInterval(()=>{y()},3e4)}function y(){if(!e.isPollingActive)return;const L=(Date.now()-e.lastActivityTime)/1e3;let M;L>i.idleThreshold?M=i.idleInterval:L>i.activityThreshold?M=i.inactiveInterval:M=i.initialInterval,M!==e.currentInterval&&(e.currentInterval=M,n.emit("activity:intervalChanged",{interval:e.currentInterval}))}function b(m){e.isPollingActive=m,e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call(m?"activatePolling":"deactivatePolling"),n.emit("activity:pollingStateChanged",{active:m})}function S(){return e.currentInterval}function F(){e.checkIntervalId&&(clearInterval(e.checkIntervalId),e.checkIntervalId=null),e.activityListeners.forEach(({element:m,type:L,handler:M})=>{m.removeEventListener(L,M)}),e.activityListeners=[]}function k(m){e.livewireComponent=m}return{init:t,recordActivity:d,getCurrentInterval:S,updatePollingState:b,registerLivewireComponent:k,dispose:F}}function Y(a){a.data("activityMonitor",i=>{const e=se(i);return{init(){e.init(this.$el,this.$wire),n.on("activity:intervalChanged",({interval:t})=>{this.$wire&&typeof this.$wire.set=="function"&&this.$wire.set("pollingInterval",t)})},recordActivity(){e.recordActivity()},getCurrentInterval(){return e.getCurrentInterval()},updatePollingState(t){e.updatePollingState(t)}}})}window.Alpine?Y(window.Alpine):document.addEventListener("alpine:init",()=>{Y(window.Alpine)});function re(a={}){const i={activeTab:null,tabsVisible:a.tabsVisible!==!1,availableTabs:[],tabConfigs:{ticket:{enabled:!1,label:"Tickets"},agent:{enabled:!1,label:"Chat"},knowledgebase:{enabled:!1,label:"Knowledge Base"}},livewireComponent:null};function e(l={},c=null){i.livewireComponent=c,t(l),i.activeTab||p(he(l)||i.availableTabs[0]),d()}function t(l){typeof l.tabsVisible<"u"&&(i.tabsVisible=l.tabsVisible),["ticket","agent","knowledgebase"].forEach(c=>{l[c]&&typeof l[c].enabled<"u"&&(i.tabConfigs[c].enabled=l[c].enabled,l[c].label&&(i.tabConfigs[c].label=l[c].label))}),r()}function r(){i.availableTabs=Object.keys(i.tabConfigs).filter(l=>i.tabConfigs[l].enabled)}function d(){n.on("ticket:created",l=>{i.tabConfigs.ticket.enabled&&(p("ticket",!1),y(!1))})}function p(l,c=!0){var m;!((m=i.tabConfigs[l])!=null&&m.enabled)||l===i.activeTab||(i.activeTab=l,b(l),c&&n.emit("tab:changed",{tab:l,previous:i.activeTab,config:i.tabConfigs[l]}))}function y(l){i.tabsVisible!==l&&(i.tabsVisible=l,i.livewireComponent&&typeof i.livewireComponent.set=="function"&&i.livewireComponent.set("chatConfig.tabsVisible",l),n.emit("tabs:visibilityChanged",{visible:l}))}function b(l){if(!i.livewireComponent||typeof i.livewireComponent.call!="function")return;const c=`${l}TabSelected`;typeof i.livewireComponent[c]<"u"?i.livewireComponent.call(c):i.livewireComponent.call("tabSelected",l)}function S(){return i.activeTab}function F(l){return i.activeTab===l}function k(){return[...i.availableTabs]}function E(l){return i.tabConfigs[l]||null}function x(){return i.tabsVisible}function A(l){i.livewireComponent=l}return{init:e,setActiveTab:p,getActiveTab:S,isTabActive:F,getAvailableTabs:k,getTabConfig:E,setTabsVisibility:y,areTabsVisible:x,registerLivewireComponent:A}}function G(a){a.data("tabManager",i=>{const e=re(i);return{activeTab:null,tabsVisible:!0,init(){e.init(i,this.$wire),this.activeTab=e.getActiveTab(),this.tabsVisible=e.areTabsVisible(),n.on("tab:changed",({tab:t})=>{this.activeTab=t}),n.on("tabs:visibilityChanged",({visible:t})=>{this.tabsVisible=t})},selectTab(t){e.setActiveTab(t),this.activeTab=t},isTabActive(t){return this.activeTab===t},getAvailableTabs(){return e.getAvailableTabs()},getTabConfig(t){return e.getTabConfig(t)}}})}window.Alpine?G(window.Alpine):document.addEventListener("alpine:init",()=>{G(window.Alpine)});function oe(a={}){var L,M,P,R;const i={enabled:((L=a.fileUpload)==null?void 0:L.enabled)!==!1,maxSize:((M=a.fileUpload)==null?void 0:M.maxSize)||5,maxFiles:((P=a.fileUpload)==null?void 0:P.maxFiles)||3,allowedTypes:((R=a.fileUpload)==null?void 0:R.allowedTypes)||["image/*","application/pdf",".doc",".docx",".xls",".xlsx"]},e={pendingFiles:[],livewireComponent:null,fileInputElement:null};function t(u,T=null){e.livewireComponent=T,u&&(e.fileInputElement=u.querySelector('input[type="file"]')),r()}function r(){n.on("message:sent",()=>{S()})}function d(u){if(!i.enabled)return{success:!1,message:"File uploads are disabled"};const T=Array.from(u);if(e.pendingFiles.length+T.length>i.maxFiles)return{success:!1,message:`Maximum ${i.maxFiles} files allowed`};const v=[],I=[];return T.forEach(g=>{const C=p(g);C.success?v.push(C.fileData):I.push(C.message)}),v.length>0&&(e.pendingFiles=[...e.pendingFiles,...v],n.emit("files:added",{files:v,allFiles:e.pendingFiles})),{success:v.length>0,message:I.length>0?I.join(", "):"Files added successfully",addedCount:v.length,errorCount:I.length}}function p(u){if(u.size>i.maxSize*1024*1024)return{success:!1,message:`File "${u.name}" exceeds maximum size of ${i.maxSize}MB`};if(i.allowedTypes&&i.allowedTypes.length>0){const v=u.type,I="."+u.name.split(".").pop().toLowerCase();if(!i.allowedTypes.some(C=>{if(C.startsWith("."))return C.toLowerCase()===I;if(C.endsWith("/*")){const $=C.slice(0,-2);return v.startsWith($)}else return C===v}))return{success:!1,message:`File type "${v}" is not allowed`}}const T={id:Date.now()+"-"+Math.random().toString(36).substr(2,9),file:u,name:u.name,size:u.size,type:u.type,formattedSize:y(u.size),preview:null,status:"pending"};if(u.type.startsWith("image/")){const v=new FileReader;v.onload=I=>{T.preview=I.target.result,n.emit("file:previewReady",{fileId:T.id,preview:T.preview})},v.readAsDataURL(u)}return{success:!0,fileData:T}}function y(u){return u<1024?u+" bytes":u<1048576?Math.round(u/1024)+" KB":(u/1048576).toFixed(1)+" MB"}function b(u){const T=e.pendingFiles.length;e.pendingFiles=e.pendingFiles.filter(I=>I.id!==u);const v=e.pendingFiles.length<T;return v&&n.emit("file:removed",{fileId:u,remainingFiles:e.pendingFiles}),v}function S(){e.pendingFiles.length!==0&&(e.pendingFiles=[],e.fileInputElement&&(e.fileInputElement.value=""),n.emit("files:cleared"))}function F(){return[...e.pendingFiles]}function k(u){return e.pendingFiles.find(T=>T.id===u)||null}function E(){return e.pendingFiles.length>0}function x(){return e.pendingFiles.length}function A(){return e.pendingFiles.map(u=>u.file)}function l(){return i.enabled}function c(u){e.livewireComponent=u}function m(){i.enabled&&(e.fileInputElement?e.fileInputElement.click():console.warn("No file input element found"))}return{init:t,handleFiles:d,removeFile:b,clearPendingFiles:S,getPendingFiles:F,getFileById:k,hasPendingFiles:E,getPendingFileCount:x,getPendingFileObjects:A,isEnabled:l,registerLivewireComponent:c,triggerFileSelection:m}}function X(a){a.data("fileUpload",i=>{const e=oe(i);return{pendingFiles:[],enabled:!0,init(){e.init(this.$el,this.$wire),this.pendingFiles=[],this.enabled=e.isEnabled(),n.on("files:added",({allFiles:t})=>{this.pendingFiles=t}),n.on("file:removed",({remainingFiles:t})=>{this.pendingFiles=t}),n.on("files:cleared",()=>{this.pendingFiles=[]}),n.on("file:previewReady",({fileId:t,preview:r})=>{const d=this.pendingFiles.findIndex(p=>p.id===t);if(d>=0){const p=[...this.pendingFiles];p[d]={...p[d],preview:r},this.pendingFiles=p}})},handleFileSelect(t){if(!t.target.files||t.target.files.length===0)return;const r=e.handleFiles(t.target.files);t.target.value="",r.errorCount>0&&console.warn(r.message)},removeFile(t){e.removeFile(t)},clearFiles(){e.clearPendingFiles()},triggerFileSelection(){e.triggerFileSelection()},getCount(){return this.pendingFiles.length},getPendingFiles(){return this.pendingFiles}}})}window.Alpine?X(window.Alpine):document.addEventListener("alpine:init",()=>{X(window.Alpine)});function le(a={}){var P,R,u,T,v,I;const i={enabled:((P=a.ticket)==null?void 0:P.enabled)!==!1,submitButtonText:((R=a.ticket)==null?void 0:R.submitButtonText)||"Submit Ticket",formTitlePlaceholder:((u=a.ticket)==null?void 0:u.formTitlePlaceholder)||"How can we help you?",formDescriptionPlaceholder:((T=a.ticket)==null?void 0:T.formDescriptionPlaceholder)||"Please describe your issue...",autoShowForm:((v=a.ticket)==null?void 0:v.autoShowForm)!==!1,showAttachments:((I=a.ticket)==null?void 0:I.showAttachments)!==!1},e={activeTicketId:null,ticketTitle:"",ticketDescription:"",isSubmitting:!1,formErrors:{},livewireComponent:null,fileUploadManager:null};function t(g=null,C=null){e.livewireComponent=g,e.fileUploadManager=C,r()}function r(){n.on("tab:changed",({tab:g})=>{g==="ticket"&&!e.activeTicketId&&d()})}function d(){e.ticketTitle="",e.ticketDescription="",e.formErrors={},e.fileUploadManager&&e.fileUploadManager.clearPendingFiles(),n.emit("ticket:formPrepared")}function p(g){e.ticketTitle=g,e.formErrors.title&&(delete e.formErrors.title,n.emit("ticket:formErrorsChanged",{errors:e.formErrors}))}function y(g){e.ticketDescription=g,e.formErrors.description&&(delete e.formErrors.description,n.emit("ticket:formErrorsChanged",{errors:e.formErrors}))}function b(){const g={};return e.ticketTitle.trim()?e.ticketTitle.length<5&&(g.title="Title must be at least 5 characters"):g.title="Please enter a title for your ticket",e.ticketDescription.trim()?e.ticketDescription.length<10&&(g.description="Description must be at least 10 characters"):g.description="Please describe your issue",e.formErrors=g,n.emit("ticket:formErrorsChanged",{errors:g}),Object.keys(g).length===0}async function S(){if(!e.isSubmitting){if(!b())return Promise.reject(new Error("Form validation failed"));e.isSubmitting=!0,n.emit("ticket:submitting",{isSubmitting:!0});try{const g=e.fileUploadManager?e.fileUploadManager.getPendingFileObjects():[],C={title:e.ticketTitle,description:e.ticketDescription,attachments:g};if(e.livewireComponent&&typeof e.livewireComponent.call=="function"){typeof e.livewireComponent.set=="function"&&(e.livewireComponent.set("dataTicket.title",C.title),e.livewireComponent.set("dataTicket.description",C.description));const $=await e.livewireComponent.call("ticketCreate");if($&&$.id)return F($),$}throw n.emit("ticket:submissionFailed",{error:"Failed to create ticket",formData:C}),new Error("Failed to create ticket")}catch(g){throw console.error("Error creating ticket:",g),e.formErrors.general="Failed to create ticket. Please try again.",n.emit("ticket:formErrorsChanged",{errors:e.formErrors}),g}finally{e.isSubmitting=!1,n.emit("ticket:submitting",{isSubmitting:!1})}}}function F(g){e.activeTicketId=g.id,d(),n.emit("ticket:created",g)}function k(g,C=null){e.activeTicketId!==g&&(e.activeTicketId=g,n.emit("ticket:activated",{id:g,data:C}))}function E(){if(!e.activeTicketId)return;const g=e.activeTicketId;e.activeTicketId=null,n.emit("ticket:deactivated",{id:g}),d()}function x(){return!!e.activeTicketId}function A(){return e.activeTicketId}function l(){return{title:e.ticketTitle,description:e.ticketDescription,errors:e.formErrors,isSubmitting:e.isSubmitting}}function c(){return i.enabled}function m(){return{...i}}function L(g){e.livewireComponent=g}function M(g){e.fileUploadManager=g}return{init:t,setTicketTitle:p,setTicketDescription:y,validateForm:b,submitTicketForm:S,prepareTicketForm:d,setActiveTicket:k,clearActiveTicket:E,hasActiveTicket:x,getActiveTicketId:A,getFormData:l,isEnabled:c,getSettings:m,registerLivewireComponent:L,registerFileUploadManager:M}}function Z(a){a.data("ticketModule",i=>{const e=le(i);return{ticketTitle:"",ticketDescription:"",formErrors:{},isSubmitting:!1,activeTicketId:null,settings:{},init(){let t=null;this.$store&&this.$store.fileUpload&&(t=this.$store.fileUpload),e.init(this.$wire,t),this.settings=e.getSettings(),this.activeTicketId=e.getActiveTicketId(),this.$watch("ticketTitle",r=>{e.setTicketTitle(r)}),this.$watch("ticketDescription",r=>{e.setTicketDescription(r)}),n.on("ticket:formErrorsChanged",({errors:r})=>{this.formErrors=r}),n.on("ticket:submitting",({isSubmitting:r})=>{this.isSubmitting=r}),n.on("ticket:activated",({id:r})=>{this.activeTicketId=r}),n.on("ticket:deactivated",()=>{this.activeTicketId=null})},submitForm(){e.submitTicketForm().catch(t=>console.error("Form submission error:",t))},hasActiveTicket(){return e.hasActiveTicket()},clearTicket(){e.clearActiveTicket()}}})}window.Alpine?Z(window.Alpine):document.addEventListener("alpine:init",()=>{Z(window.Alpine)});function ce(a={}){var v,I,g,C,$,B,D,f;const i={messageLimit:((v=a.ticketChat)==null?void 0:v.messageLimit)||20,autoScrollToBottom:((I=a.ticketChat)==null?void 0:I.autoScrollToBottom)!==!1,showTimestamps:((g=a.ticketChat)==null?void 0:g.showTimestamps)!==!1,showAvatars:((C=a.ticketChat)==null?void 0:C.showAvatars)!==!1,placeholderText:(($=a.ticketChat)==null?void 0:$.placeholderText)||"Type your message...",systemMessageColor:((B=a.ticketChat)==null?void 0:B.systemMessageColor)||"gray",agentMessageColor:((D=a.ticketChat)==null?void 0:D.agentMessageColor)||"blue",userMessageColor:((f=a.ticketChat)==null?void 0:f.userMessageColor)||"primary"},e={ticketId:null,messages:[],newMessage:"",isLoading:!1,hasMoreMessages:!1,lastLoadedMessageId:null,lastVisibleMessageId:null,typingUsers:[],livewireComponent:null,fileUploadManager:null,messagesContainer:null};function t(s,h=null,U=null){e.livewireComponent=h,e.fileUploadManager=U,s&&(e.messagesContainer=s.querySelector(".messages-container")),r()}function r(){n.on("ticket:created",s=>{d(s.id)}),n.on("ticket:activated",({id:s})=>{d(s)}),n.on("ticket:newMessages",({messages:s})=>{b(s)})}function d(s){e.ticketId!==s&&(e.ticketId=s,e.messages=[],e.newMessage="",e.isLoading=!1,e.hasMoreMessages=!1,e.lastLoadedMessageId=null,e.lastVisibleMessageId=null,p(),n.emit("ticketChat:activated",{ticketId:s}))}async function p(s=!1){if(!e.ticketId||e.isLoading)return Promise.resolve([]);e.isLoading=!0,n.emit("ticketChat:loading",{isLoading:!0,loadingOlder:s});try{let h=[];if(e.livewireComponent&&typeof e.livewireComponent.call=="function"){const U=s?"loadOlderMessages":"loadMessages",O=s?{beforeId:e.lastLoadedMessageId}:{};h=await e.livewireComponent.call(U,O)}return h&&h.length>0&&(s?b(h,!0):b(h)),e.hasMoreMessages=h.length>=i.messageLimit,h}catch(h){return console.error("Error loading messages:",h),[]}finally{e.isLoading=!1,n.emit("ticketChat:loading",{isLoading:!1,loadingOlder:s})}}function y(){return p(!0)}function b(s,h=!1){if(!s||s.length===0)return;const U=s.map(S);h?(e.messages=[...U,...e.messages],e.lastLoadedMessageId=U[0].id):(e.messages=[...e.messages,...U],e.lastLoadedMessageId=U[U.length-1].id,i.autoScrollToBottom&&setTimeout(()=>k(),100)),n.emit("ticketChat:messagesAdded",{messages:U,prepend:h})}function S(s){return{id:s.id,content:s.content||s.text||s.body||"",sender_type:s.sender_type||s.type||"user",user_id:s.user_id||s.sender_id||null,created_at:s.created_at||s.timestamp||new Date().toISOString(),formatted_time:s.formatted_time||F(s.created_at||s.timestamp),attachments:s.attachments||[],is_read:s.is_read||!1}}function F(s){if(!s)return"";try{return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return""}}function k(){e.messagesContainer&&(e.messagesContainer.scrollTop=e.messagesContainer.scrollHeight)}function E(s){e.newMessage=s}async function x(){if(!e.ticketId||!e.newMessage.trim())return Promise.resolve(!1);const s=e.fileUploadManager?e.fileUploadManager.getPendingFileObjects():[],h={content:e.newMessage.trim(),ticketId:e.ticketId,attachments:s};try{return e.livewireComponent&&(typeof e.livewireComponent.set=="function"&&e.livewireComponent.set("newMessage",h.content),typeof e.livewireComponent.call=="function"&&await e.livewireComponent.call("sendMessage")),e.newMessage="",e.fileUploadManager&&e.fileUploadManager.clearPendingFiles(),n.emit("ticketChat:messageSent",h),n.emit("message:sent",h),!0}catch(U){return console.error("Error sending message:",U),n.emit("ticketChat:error",{error:"Failed to send message",messageData:h}),!1}}function A(){e.ticketId&&(e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(typeof e.livewireComponent.broadcastTyping<"u"?e.livewireComponent.call("broadcastTyping",!0):typeof e.livewireComponent.startTyping<"u"&&e.livewireComponent.call("startTyping")),n.emit("ticketChat:typing",{isTyping:!0}))}function l(){e.ticketId&&(e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(typeof e.livewireComponent.broadcastTyping<"u"?e.livewireComponent.call("broadcastTyping",!1):typeof e.livewireComponent.stopTyping<"u"&&e.livewireComponent.call("stopTyping")),n.emit("ticketChat:typing",{isTyping:!1}))}function c(){e.ticketId&&e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("markMessagesAsRead")}function m(){return e.ticketId}function L(){return[...e.messages]}function M(){return e.newMessage}function P(){return e.isLoading}function R(){return e.hasMoreMessages}function u(s){e.livewireComponent=s}function T(s){e.fileUploadManager=s}return{init:t,activateTicket:d,loadMessages:p,loadOlderMessages:y,setNewMessage:E,sendMessage:x,startTyping:A,stopTyping:l,markMessagesAsRead:c,scrollToBottom:k,getTicketId:m,getMessages:L,getNewMessage:M,isLoading:P,hasMoreMessages:R,registerLivewireComponent:u,registerFileUploadManager:T}}function ee(a){a.data("ticketChat",i=>{const e=ce(i);return{ticketId:null,messages:[],newMessage:"",isLoading:!1,hasMoreMessages:!1,typingTimeout:null,isTyping:!1,init(){let t=null;this.$store&&this.$store.fileUpload&&(t=this.$store.fileUpload),e.init(this.$el,this.$wire,t),this.ticketId=e.getTicketId(),this.messages=e.getMessages(),this.newMessage=e.getNewMessage(),this.isLoading=e.isLoading(),this.hasMoreMessages=e.hasMoreMessages(),n.on("ticketChat:activated",({ticketId:r})=>{this.ticketId=r}),n.on("ticketChat:messagesAdded",()=>{this.messages=e.getMessages(),this.hasMoreMessages=e.hasMoreMessages()}),n.on("ticketChat:loading",({isLoading:r})=>{this.isLoading=r})},loadOlderMessages(){e.loadOlderMessages()},sendMessage(){this.isTyping&&(clearTimeout(this.typingTimeout),this.isTyping=!1,e.stopTyping()),e.setNewMessage(this.newMessage),e.sendMessage().then(()=>{this.newMessage=""})},handleTyping(){this.isTyping||(this.isTyping=!0,e.startTyping()),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.isTyping=!1,e.stopTyping()},2e3)},scrollToBottom(){e.scrollToBottom()}}})}window.Alpine?ee(window.Alpine):document.addEventListener("alpine:init",()=>{ee(window.Alpine)});function de(a={}){var U,O,V,j,z,W,q,J,N,K;const i={enabled:((U=a.agent)==null?void 0:U.enabled)!==!1,waitingMessage:((O=a.agent)==null?void 0:O.waitingMessage)||"Waiting for an agent to join...",placeholderText:((V=a.agent)==null?void 0:V.placeholderText)||"Type your message...",agentTypingText:((j=a.agent)==null?void 0:j.agentTypingText)||"Agent is typing...",userTypingText:((z=a.agent)==null?void 0:z.userTypingText)||"You are typing...",agentMessageColor:((W=a.agent)==null?void 0:W.agentMessageColor)||"blue",userMessageColor:((q=a.agent)==null?void 0:q.userMessageColor)||"primary",autoScrollToBottom:((J=a.agent)==null?void 0:J.autoScrollToBottom)!==!1,agentAvailabilityCheck:((N=a.agent)==null?void 0:N.agentAvailabilityCheck)!==!1,reconnectAttempts:((K=a.agent)==null?void 0:K.reconnectAttempts)||3},e={conversationId:null,messages:[],newMessage:"",isLoading:!1,isConnecting:!1,isConnected:!1,hasAgentJoined:!1,agentName:"",agentTyping:!1,userTyping:!1,typingTimeout:null,connectingTimeout:null,reconnectAttempt:0,livewireComponent:null,fileUploadManager:null,messagesContainer:null};function t(o,w=null,Q=null){e.livewireComponent=w,e.fileUploadManager=Q,o&&(e.messagesContainer=o.querySelector(".messages-container")),r(),w&&typeof w.get=="function"&&w.get("conversationId")&&(e.conversationId=w.get("conversationId"),F())}function r(){n.on("agent:newMessage",({message:o})=>{x(o)}),n.on("agent:typing",({isTyping:o,agentName:w})=>{L(o,w)}),n.on("agent:joined",({agentName:o,conversationId:w})=>{R(o,w)}),n.on("agent:left",()=>{u()}),n.on("tab:changed",({tab:o})=>{o==="agent"&&!e.isConnected&&!e.isConnecting&&d()})}async function d(){if(!i.enabled||!i.agentAvailabilityCheck)return Promise.resolve(!1);try{if(e.livewireComponent&&typeof e.livewireComponent.call=="function"){const o=await e.livewireComponent.call("checkAgentsAvailable");return n.emit("agent:availabilityChecked",{available:o}),o}return!1}catch(o){return console.error("Error checking agent availability:",o),!1}}async function p(){if(!i.enabled||e.isConnecting||e.isConnected)return Promise.resolve(!1);e.isConnecting=!0,e.reconnectAttempt=0,e.messages=[],n.emit("agent:connecting"),A(i.waitingMessage);try{if(e.livewireComponent&&typeof e.livewireComponent.call=="function"){const o=await e.livewireComponent.call("startAgentChat");if(o&&o.success)return e.conversationId=o.conversationId,e.isConnected=!0,e.isConnecting=!1,n.emit("agent:connected",{conversationId:e.conversationId}),!0}return e.isConnecting=!1,y(),!1}catch(o){return console.error("Error starting agent chat:",o),e.isConnecting=!1,y(),!1}}function y(){if(e.reconnectAttempt>=i.reconnectAttempts){A("Unable to connect to an agent. Please try again later."),n.emit("agent:reconnectFailed");return}e.reconnectAttempt++,A(`Reconnecting (attempt ${e.reconnectAttempt} of ${i.reconnectAttempts})...`),e.connectingTimeout=setTimeout(()=>{p()},3e3)}async function b(){if(!e.isConnected&&!e.isConnecting)return Promise.resolve(!1);e.connectingTimeout&&(clearTimeout(e.connectingTimeout),e.connectingTimeout=null);try{return e.livewireComponent&&typeof e.livewireComponent.call=="function"&&await e.livewireComponent.call("endAgentChat"),S(),A("Chat ended."),n.emit("agent:disconnected"),!0}catch(o){return console.error("Error ending agent chat:",o),S(),!1}}function S(){e.conversationId=null,e.isConnected=!1,e.isConnecting=!1,e.hasAgentJoined=!1,e.agentName="",e.agentTyping=!1,e.reconnectAttempt=0}async function F(){if(!e.conversationId||e.isLoading)return Promise.resolve([]);e.isLoading=!0,n.emit("agent:loading",{isLoading:!0});try{let o=[];return e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(o=await e.livewireComponent.call("loadAgentMessages")),o&&o.length>0&&(e.messages=o.map(k),n.emit("agent:messagesLoaded",{messages:e.messages}),i.autoScrollToBottom&&setTimeout(()=>l(),100)),e.messages}catch(o){return console.error("Error loading agent messages:",o),[]}finally{e.isLoading=!1,n.emit("agent:loading",{isLoading:!1})}}function k(o){return{id:o.id,content:o.content||o.text||o.body||"",sender_type:o.sender_type||o.type||"user",user_id:o.user_id||o.sender_id||null,agent_id:o.agent_id||null,created_at:o.created_at||o.timestamp||new Date().toISOString(),formatted_time:o.formatted_time||E(o.created_at||o.timestamp),attachments:o.attachments||[]}}function E(o){if(!o)return"";try{return new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return""}}function x(o){const w=k(o);e.messages.push(w),n.emit("agent:messageAdded",{message:w}),i.autoScrollToBottom&&setTimeout(()=>l(),100)}function A(o){const w={id:"system-"+Date.now(),content:o,sender_type:"system",created_at:new Date().toISOString(),formatted_time:E(new Date().toISOString()),attachments:[]};e.messages.push(w),n.emit("agent:messageAdded",{message:w}),i.autoScrollToBottom&&setTimeout(()=>l(),100)}function l(){e.messagesContainer&&(e.messagesContainer.scrollTop=e.messagesContainer.scrollHeight)}function c(o){e.newMessage=o}async function m(){if(!e.conversationId||!e.isConnected||!e.newMessage.trim())return Promise.resolve(!1);const o=e.fileUploadManager?e.fileUploadManager.getPendingFileObjects():[],w={content:e.newMessage.trim(),conversationId:e.conversationId,attachments:o},Q=e.newMessage;e.newMessage="";try{return e.livewireComponent&&(typeof e.livewireComponent.set=="function"&&e.livewireComponent.set("newMessage",Q),typeof e.livewireComponent.call=="function"&&await e.livewireComponent.call("sendAgentMessage")),e.fileUploadManager&&e.fileUploadManager.clearPendingFiles(),n.emit("agent:messageSent",w),n.emit("message:sent",w),!0}catch(ue){return console.error("Error sending message to agent:",ue),n.emit("agent:error",{error:"Failed to send message",messageData:w}),!1}}function L(o,w=""){e.agentTyping=o,w&&!e.agentName&&(e.agentName=w),n.emit("agent:typingChanged",{isTyping:o,agentName:e.agentName})}function M(){e.isConnected&&(e.userTyping=!0,e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("broadcastTyping",!0),n.emit("agent:userTypingChanged",{isTyping:!0}))}function P(){e.isConnected&&(e.userTyping=!1,e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("broadcastTyping",!1),n.emit("agent:userTypingChanged",{isTyping:!1}))}function R(o,w){e.hasAgentJoined=!0,e.agentName=o,w&&!e.conversationId&&(e.conversationId=w),A(`${o} has joined the chat.`),n.emit("agent:joined",{agentName:o,conversationId:e.conversationId})}function u(){e.hasAgentJoined&&A(`${e.agentName||"Agent"} has left the chat.`),e.hasAgentJoined=!1,e.agentTyping=!1,n.emit("agent:left")}function T(){return[...e.messages]}function v(){return e.newMessage}function I(){return e.isLoading}function g(){return e.isConnecting}function C(){return e.isConnected}function $(){return e.hasAgentJoined}function B(){return e.agentName}function D(){return e.agentTyping}function f(){return i.enabled}function s(o){e.livewireComponent=o}function h(o){e.fileUploadManager=o}return{init:t,checkAgentAvailability:d,startChat:p,endChat:b,loadMessages:F,setNewMessage:c,sendMessage:m,startTyping:M,stopTyping:P,scrollToBottom:l,getMessages:T,getNewMessage:v,isLoading:I,isConnecting:g,isConnected:C,hasAgentJoined:$,getAgentName:B,isAgentTyping:D,isEnabled:f,registerLivewireComponent:s,registerFileUploadManager:h}}function te(a){a.data("agentChat",i=>{const e=de(i);return{messages:[],newMessage:"",isLoading:!1,isConnecting:!1,isConnected:!1,hasAgentJoined:!1,agentName:"",agentTyping:!1,userTyping:!1,typingTimeout:null,init(){let t=null;this.$store&&this.$store.fileUpload&&(t=this.$store.fileUpload),e.init(this.$el,this.$wire,t),this.messages=e.getMessages(),this.newMessage=e.getNewMessage(),this.isLoading=e.isLoading(),this.isConnecting=e.isConnecting(),this.isConnected=e.isConnected(),this.hasAgentJoined=e.hasAgentJoined(),this.agentName=e.getAgentName(),this.agentTyping=e.isAgentTyping(),n.on("agent:messageAdded",()=>{this.messages=e.getMessages()}),n.on("agent:typingChanged",({isTyping:r})=>{this.agentTyping=r}),n.on("agent:connecting",()=>{this.isConnecting=!0,this.isConnected=!1}),n.on("agent:connected",()=>{this.isConnecting=!1,this.isConnected=!0}),n.on("agent:disconnected",()=>{this.isConnecting=!1,this.isConnected=!1,this.hasAgentJoined=!1,this.agentName="",this.agentTyping=!1}),n.on("agent:joined",({agentName:r})=>{this.hasAgentJoined=!0,this.agentName=r}),n.on("agent:left",()=>{this.hasAgentJoined=!1,this.agentTyping=!1}),n.on("agent:loading",({isLoading:r})=>{this.isLoading=r})},startChat(){e.startChat()},endChat(){e.endChat()},sendMessage(){this.userTyping&&(clearTimeout(this.typingTimeout),this.userTyping=!1,e.stopTyping()),e.setNewMessage(this.newMessage),e.sendMessage().then(()=>{this.newMessage=""})},handleTyping(){this.userTyping||(this.userTyping=!0,e.startTyping()),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.userTyping=!1,e.stopTyping()},2e3)},scrollToBottom(){e.scrollToBottom()}}})}window.Alpine?te(window.Alpine):document.addEventListener("alpine:init",()=>{te(window.Alpine)});function ge(a={}){var u,T,v,I,g,C,$,B,D;const i={enabled:((u=a.knowledgebase)==null?void 0:u.enabled)!==!1,searchPlaceholder:((T=a.knowledgebase)==null?void 0:T.searchPlaceholder)||"Search for answers...",noResultsMessage:((v=a.knowledgebase)==null?void 0:v.noResultsMessage)||"No results found. Please try a different search term or create a ticket.",initialMessage:((I=a.knowledgebase)==null?void 0:I.initialMessage)||"What can we help you find?",minSearchLength:((g=a.knowledgebase)==null?void 0:g.minSearchLength)||3,searchDelay:((C=a.knowledgebase)==null?void 0:C.searchDelay)||500,maxResults:(($=a.knowledgebase)==null?void 0:$.maxResults)||10,showRelatedArticles:((B=a.knowledgebase)==null?void 0:B.showRelatedArticles)!==!1,autoSearch:((D=a.knowledgebase)==null?void 0:D.autoSearch)!==!1},e={searchQuery:"",results:[],isSearching:!1,activeArticleId:null,activeArticle:null,searchTimeout:null,lastSearchQuery:"",hasSearched:!1,livewireComponent:null};function t(f=null){if(e.livewireComponent=f,r(),f&&typeof f.get=="function"&&f.get("knowledgebase.query")){const s=f.get("knowledgebase.query");s&&s.length>=i.minSearchLength&&(e.searchQuery=s,p(s))}}function r(){n.on("tab:changed",({tab:f})=>{f==="knowledgebase"&&i.autoSearch&&e.searchQuery.length>=i.minSearchLength&&!e.hasSearched&&p(e.searchQuery)})}function d(f,s=!0){e.searchQuery=f,e.searchTimeout&&(clearTimeout(e.searchTimeout),e.searchTimeout=null),e.livewireComponent&&typeof e.livewireComponent.set=="function"&&e.livewireComponent.set("knowledgebase.query",f),s&&f.length>=i.minSearchLength?e.searchTimeout=setTimeout(()=>{p(f)},i.searchDelay):f.length===0&&y()}async function p(f=null){const s=f||e.searchQuery;if(s.length<i.minSearchLength||s===e.lastSearchQuery)return Promise.resolve(e.results);e.isSearching=!0,e.lastSearchQuery=s,e.hasSearched=!0,n.emit("kb:searching",{query:s});try{let h=[];return e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(h=await e.livewireComponent.call("searchKnowledgeBase",{query:s,limit:i.maxResults})),e.results=h||[],n.emit("kb:searchCompleted",{query:s,results:e.results,count:e.results.length}),e.results}catch(h){return console.error("Error searching knowledge base:",h),e.results=[],n.emit("kb:error",{error:"Failed to search knowledge base",query:s}),[]}finally{e.isSearching=!1}}function y(){e.results=[],e.lastSearchQuery="",e.hasSearched=!1,n.emit("kb:resultsCleared")}async function b(f){if(!i.enabled||!f)return Promise.resolve(null);try{let s=null;const h=e.results.find(U=>U.id==f);return h&&h.fullContent?s=h:e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(s=await e.livewireComponent.call("loadKnowledgeBaseArticle",{articleId:f})),s?(e.activeArticleId=f,e.activeArticle=s,n.emit("kb:articleLoaded",{article:s}),s):null}catch(s){return console.error("Error loading knowledge base article:",s),n.emit("kb:error",{error:"Failed to load article",articleId:f}),null}}function S(){if(!e.activeArticleId)return;const f=e.activeArticleId;e.activeArticleId=null,e.activeArticle=null,n.emit("kb:articleClosed",{articleId:f})}function F(f){f&&e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("trackKnowledgeBaseArticleView",{articleId:f})}function k(f,s){f&&(e.livewireComponent&&typeof e.livewireComponent.call=="function"&&e.livewireComponent.call("rateKnowledgeBaseArticle",{articleId:f,helpful:s}),n.emit("kb:articleRated",{articleId:f,helpful:s}))}async function E(f){if(!i.enabled||!i.showRelatedArticles||!f)return Promise.resolve([]);try{let s=[];return e.livewireComponent&&typeof e.livewireComponent.call=="function"&&(s=await e.livewireComponent.call("findRelatedKnowledgeBaseArticles",{articleId:f})),n.emit("kb:relatedArticlesLoaded",{articleId:f,relatedArticles:s}),s}catch(s){return console.error("Error finding related articles:",s),[]}}function x(){e.searchQuery&&(n.emit("kb:createTicketRequested",{query:e.searchQuery}),n.emit("tab:requestChange",{tab:"ticket"}))}function A(){return e.searchQuery}function l(){return[...e.results]}function c(){return e.isSearching}function m(){return e.activeArticleId}function L(){return e.activeArticle}function M(){return i.enabled}function P(){return{...i}}function R(f){e.livewireComponent=f}return{init:t,setSearchQuery:d,search:p,clearResults:y,loadArticle:b,closeArticle:S,trackArticleView:F,rateArticle:k,findRelatedArticles:E,createTicketFromQuery:x,getSearchQuery:A,getResults:l,isSearching:c,getActiveArticleId:m,getActiveArticle:L,isEnabled:M,getSettings:P,registerLivewireComponent:R}}function ie(a){a.data("knowledgebase",i=>{const e=ge(i);return{searchQuery:"",results:[],isSearching:!1,activeArticleId:null,activeArticle:null,relatedArticles:[],settings:{},init(){e.init(this.$wire),this.searchQuery=e.getSearchQuery(),this.results=e.getResults(),this.isSearching=e.isSearching(),this.activeArticleId=e.getActiveArticleId(),this.activeArticle=e.getActiveArticle(),this.settings=e.getSettings(),n.on("kb:searching",()=>{this.isSearching=!0}),n.on("kb:searchCompleted",({results:t})=>{this.results=t,this.isSearching=!1}),n.on("kb:articleLoaded",({article:t})=>{this.activeArticleId=t.id,this.activeArticle=t,e.findRelatedArticles(t.id).then(r=>{this.relatedArticles=r})}),n.on("kb:articleClosed",()=>{this.activeArticleId=null,this.activeArticle=null,this.relatedArticles=[]}),n.on("tab:requestChange",({tab:t})=>{t==="ticket"&&this.$parent&&typeof this.$parent.selectTab=="function"&&this.$parent.selectTab("ticket")})},search(){e.setSearchQuery(this.searchQuery),e.search()},handleInput(t){const r=t.target.value;this.searchQuery=r,e.setSearchQuery(r)},clearSearch(){this.searchQuery="",e.setSearchQuery(""),e.clearResults(),this.results=[]},viewArticle(t){e.loadArticle(t).then(r=>{r&&e.trackArticleView(t)})},closeArticle(){e.closeArticle()},rateArticle(t){this.activeArticleId&&e.rateArticle(this.activeArticleId,t)},createTicket(){e.createTicketFromQuery()}}})}window.Alpine?ie(window.Alpine):document.addEventListener("alpine:init",()=>{ie(window.Alpine)});function ve(a={}){const i=pe(a),e=me(i),t={open:e.open||!1,initialized:!1,registeredComponents:new Set,managers:{},livewireComponent:null};function r(c,m=null){t.initialized||(t.livewireComponent=m,d(c),p(),t.initialized=!0,n.emit("chat:initialized",{settings:e}))}function d(c){t.managers.activity=se(e),t.managers.activity.init(c,t.livewireComponent),t.managers.tabs=re(e),t.managers.tabs.init(e,t.livewireComponent),t.managers.fileUpload=oe(e),t.managers.fileUpload.init(c,t.livewireComponent),t.managers.ticket=le(e),t.managers.ticket.init(t.livewireComponent,t.managers.fileUpload),t.managers.ticketChat=ce(e),t.managers.ticketChat.init(c,t.livewireComponent,t.managers.fileUpload),t.managers.agentChat=de(e),t.managers.agentChat.init(c,t.livewireComponent,t.managers.fileUpload),t.managers.knowledgebase=ge(e),t.managers.knowledgebase.init(t.livewireComponent)}function p(){n.on("ticket:created",c=>{t.managers.tabs&&t.managers.tabs.setActiveTab("ticket")}),n.on("kb:createTicketRequested",({query:c})=>{t.managers.tabs&&t.managers.tabs.setActiveTab("ticket"),t.managers.ticket&&t.managers.ticket.setTicketTitle(c)})}function y(){t.open||(t.open=!0,t.managers.activity&&t.managers.activity.updatePollingState(!0),n.emit("chat:opened"))}function b(){t.open&&(t.open=!1,t.managers.activity&&t.managers.activity.updatePollingState(!1),n.emit("chat:closed"))}function S(){t.open?b():y()}function F(){return t.open}function k(c){return t.managers[c]||null}function E(){return{...t.managers}}function x(c){t.registeredComponents.add(c)}function A(c){return t.registeredComponents.has(c)}function l(c){t.livewireComponent=c,Object.values(t.managers).forEach(m=>{m&&typeof m.registerLivewireComponent=="function"&&m.registerLivewireComponent(c)})}return{init:r,open:y,close:b,toggle:S,isOpen:F,getManager:k,getManagers:E,registerComponent:x,isComponentRegistered:A,registerLivewireComponent:l}}function ne(a){a.data("chat",(i={})=>{const e=ve(i);return{open:!1,selectedTab:null,tabsVisible:!0,agent:{enabled:!1},ticket:{enabled:!1},knowledgebase:{enabled:!1,query:""},init(){e.init(this.$el,this.$wire),window.Alpine&&window.Alpine.store&&a.store("fileUpload",e.getManager("fileUpload")),this.open=e.isOpen();const t=e.getManager("tabs");t&&(this.selectedTab=t.getActiveTab(),this.tabsVisible=t.areTabsVisible(),t.getAvailableTabs().forEach(r=>{const d=t.getTabConfig(r);d&&this[r]&&(this[r].enabled=d.enabled)})),n.on("chat:opened",()=>{this.open=!0}),n.on("chat:closed",()=>{this.open=!1}),n.on("tab:changed",({tab:r})=>{this.selectedTab=r}),n.on("tabs:visibilityChanged",({visible:r})=>{this.tabsVisible=r})},chatOpen(){e.open()},chatClose(){e.close()},chatToggle(){e.toggle()},selectTab(t){const r=e.getManager("tabs");r&&(r.setActiveTab(t),this.selectedTab=t)},firstServiceEnabled(){return["agent","ticket","knowledgebase"].find(r=>this[r]&&this[r].enabled===!0)||null},applyConfig(t,r){Object.keys(r).forEach(d=>{d in t&&(typeof r[d]=="object"&&r[d]!==null&&typeof t[d]=="object"&&t[d]!==null?this.applyConfig(t[d],r[d]):t[d]=r[d])})}}})}window.Alpine?ne(window.Alpine):document.addEventListener("alpine:init",()=>{ne(window.Alpine)});console.log("Chat application loaded 2");
